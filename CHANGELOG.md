# Changelog
Все заметные изменения в этом проекте будут документироваться в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.1.0/).

## [0.1.1] - 2025-10-03
### Added
- Пользовательский раздел:
  - Персональные WG-конфигурации (`wg<tg_id>`) + автоматическое создание через `/api/addWireguardConfiguration`.
  - Создание пиров внутри своей конфигурации, скачивание `.conf` и QR, удаление, локальное переименование (ForceReply).
  - Экран «Мои подключения»: аккуратная таблица (RX/TX/последний HS/CFG/статус) + inline-кнопки действий.
  - Команда/кнопка «Статистика» — суммарный трафик и показатели по каждому пиру.
- Админ-раздел:
  - Общая статистика (число конфигураций, пиров, online/offline, суммарный RX/TX).
  - Просмотр всех конфигураций (число пиров, активных, трафик) + детальный список пиров с пагинацией.
- Безопасный UX:
  - Фолбэк-ответы: на любые другие команды — подсказка про `/start`/`/старт`.
  - На произвольные текстовые сообщения (например, «привет») — дружелюбный ответ с HTML-экранированием.
  - Фолбэк на не-текстовые сообщения — подсказка про `/start`.

### Changed
- `wgd_api.py`:
  - Поддержка `addWireguardConfiguration`/`deleteWireguardConfiguration`; метод `ensure_config(...)`.
  - Создание пира `add_peer_minimal(...)` с автоподбором `allowed_ip`.
  - Стабильная загрузка конфига: основной путь `GET /api/downloadPeer/<cfg>?id=<publicKey>` + запасные варианты; понимает и JSON-ответы, и octet-stream.
  - Нормализация/снимок (`snapshot()`, `totals()`) для агрегированной статистики; определение активности по последнему handshake.
  - Универсальные `create_peer(...)`, `get_peer_config(...)`, `delete_peer(...)` (принимают как id, так и publicKey).
- Хендлеры (`start.py`, `user.py`, `admin.py`):
  - Приведены к единообразному стилю, добавлены красивые inline-клавиатуры, таблицы, безопасные подсказки.

### Fixed
- Совместимость с различными форками WGDashboard 4.x (варианты полей: `id/peer_id/Id`, `publicKey/PublicKey` и т.д.).
- Устранены проблемы с пиннингом зависимостей (`pydantic`, `pydantic-settings`) и обработкой «лишних» env-переменных.

### Notes
- Переменные окружения:
  - `WGD_API_BASE`, `WGD_API_TOKEN`, `WGD_WEBHOOK_SECRET`, `DATABASE_PATH`.
  - `WGD_INTERFACE` теперь не обязателен: используется как fallback; для пользователей применяется персональная конфигурация `wg<tg_id>`.

## [0.1.0] - 2025-10-02
### Added
- Базовая структура бота (aiogram + FastAPI webhook), авторизация webhook, первичный функционал создания/удаления пиров.
